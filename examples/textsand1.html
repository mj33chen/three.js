<html>
<head>
	<title>Text Sand 1</title>
</head>
<body>
	<div id="container" style="display:block; z-index:50;"></div>
	<p>Description: we are trying to create sand particles to form the shape of text.</p>
	<p>This approach uses randomness over entire canvas, and eliminating all fall off sand.</p>
	<p>Randomness - a interesting topic in itself (link intel), but gives possibilities, lots of them really.</p>
	<p>Using the desired properties of being uniformly distributed...</p>
	<p id="2">2pm</p>
		 
	<script>
	
	var text = "Hello Sand! :)";
	var size = 40;
	var particleCount = 100000; //100000
	var particles = [];


	var container = document.getElementById('container');
	
	// calculate height needed.
	var div  = document.createElement('div');
	div.innerHTML = text;
	
	
	var width = 100, height = 100;
	
	// create canvas
	var canvas = document.createElement("canvas");
	
	var context = canvas.getContext('2d');
	//context.font = '';
	//;
	// textAlign textBaseline
	context.fillStyle = 'black';
	context.font = "20pt Arial";
	
	width = context.measureText(text).width;
	width = Math.ceil(width);
	console.log('width', width);

	
	canvas.width = width;
	canvas.height = height;
	canvas.style.width = width;
	canvas.style.height = height;
	
	console.log('width', width);
	context.font = "20pt Arial";
	context.fillText(text, 0, 20);
	
	console.log('width, height', width, height);
	document.body.appendChild(canvas);
	
	var image = context.getImageData( 0, 0, width, height );
	var data = image.data; //Uint8ClampedArray
	
	console.log('data len', data.length);
	
	var x,y, index, hit, testX, testY;
	
	for (var i=0; i<particleCount; i++) {
		x = Math.random() * width;
		y = Math.random() * height;
		
		testX = Math.floor(x); // round?
		testY = Math.floor(y);
		
		index = (testY * width + testX ) * 4;

		hit = (data[index+3] > 0); //
		
		//hit = (data[index] + data[index+1] + data[index+2]) > (128 * 3);

		if (hit) {
			particles.push({x: x, y: y});
			var e = createParticleElement();
			e.move(x*10, y* 10);
		}
		
	}
	
	console.log('particles hitted', particles.length, particles.length*100/particleCount);
	
	function createParticleElement() {
		var elm = document.createElement('canvas');
		//elm.style.border = '1px solid rgb('+Math.random()*100+'%,'+Math.random()*100+'%,'+Math.random()*100+'%)';

		var size = 10;

		elm.style.position = 'absolute';
		elm.style.width = elm.style.height = size+'px';
		elm.width = elm.height=size;
		
		var ctx = elm.getContext("2d");

		var alpha = 1;
		ctx.fillStyle = 'rgba(0, 0, 0,'+alpha+')'; 

		var r = size/3;
		ctx.arc(size/2,size/2,r,0,Math.PI*2, true);

		ctx.fill();

		//document.body.appendChild(elm);
		container.appendChild(elm);

		return {
			e: elm,
			move: function(x,y) {
				this.e.style.left = x;
				this.e.style.top = y;
				//console.log(x,y);
			}
		};

	}

	
	//e.style["-webkit-transform"] = "translate3d(" +  5 + "px," + 5 + "px, 0)";
	//e.style["transform"] = "translateZtranslate3d(" +  5 + "px," + 5 + "px, 0)";
	//e.style["-moz-transform"] = "translateZtranslate3d(" +  200 + "px," + 50 + "px, 0px)";
	//e.style["-moz-transform-origin"]  = "0 0;"
	//e.style["-moz-transform"] =  "translate(" +  100 + "px,  " + Math.floor(200) + "px)";
	
	</script>
	
</body>
</html>